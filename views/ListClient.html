<link rel="stylesheet" type="text/css" href="assets/css/fontawesome.css" />
<!-- ico-font-->
<link rel="stylesheet" type="text/css" href="assets/css/icofont.css" />
<!-- Themify icon-->
<link rel="stylesheet" type="text/css" href="assets/css/themify.css" />
<!-- Flag icon-->
<link rel="stylesheet" type="text/css" href="assets/css/flag-icon.css" />
<!-- Feather icon-->
<link rel="stylesheet" type="text/css" href="assets/css/feather-icon.css" />
<!-- Plugins css start-->
<link rel="stylesheet" type="text/css" href="assets/css/datatables.css" />
<link rel="stylesheet" type="text/css" href="assets/css/datatable-extension.css" />
<!-- Plugins css Ends-->
<!-- Bootstrap css-->
<link rel="stylesheet" type="text/css" href="assets/css/bootstrap.css" />
<!-- App css-->
<link rel="stylesheet" type="text/css" href="assets/css/style.css" />
<link id="color" rel="stylesheet" href="assets/css/color-1.css" media="screen" />
<!-- Responsive css-->
<link rel="stylesheet" type="text/css" href="assets/css/responsive.css" />

<br />
<div class="container-fluid">
  <div class="row">
    <div class="col-sm-12">
      <div class="card">
        <div class="card-header">
          <h5>Client List</h5>
          <!-- <span>Fundamentally, each button is described by an object - this object is read by Buttons and displayed as appropriate. There are a number of parameters that Buttons will automatically look for in the button description object such as buttons.buttons.text and buttons.buttons.action which are the two fundamental parameters (button text and the action to take when activated).</span> -->
        </div>
        <div class="card-body">
          <div class="dt-ext table-responsive">
            <input type="file" id="FileUpload1" style="display: none" />
            <div id="myContacts">
              <button type="file" class="btn btn-primary btn-success float-left" tabindex="0" id="uploadTopping"
                aria-controls="export-button" style="display: none"><span>Upload</span></button>
              <input type="file" id="FileUpload1" style="display: none" />
              <div id="myContacts">
                <img id="loadingImage"
                  src="https://cdn.dribbble.com/users/846207/screenshots/5568468/gradient-circle-loading.gif"
                  alt="loading-image" class="rounded" style="width: 100%; height: 100%" />
                <br><br><br>
                <p>&nbsp;&nbsp;You have zero Clients</p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script> -->

  <!-- The Modal -->
  <div id="myModal" class="modal">
    <!-- Modal content -->
    <div class="modal-dialog modal-dialog-scrollable">
      <div class="modal-content">
        <div class="modal-header">
          <h4 class="modal-title">Edit Client</h4>
          <!-- <button type="button" ng-click="close()">&times;</button> -->
          <button type="button" class="close" data-dismiss="modal" aria-label="Close" ng-click="close()">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
          <div class="form-group">
            <label class="">Email</label>
            <div class="">
              <input type="text" class="form-control" id="editEmail" ng-value="newEmail" />
            </div>
          </div>
          <div class="form-group">
            <label class="">Company Name</label>
            <div class="0">
              <input type="text" class="form-control" id="editcompanyName" ng-value="newCompanyName" />
            </div>
          </div>
          <div class="form-group">
            <label class="">Mailing Address</label>
            <div class="">
              <input type="text" class="form-control" id="editMailingAdd" ng-value="newMailingAdd" />
            </div>
          </div>
          <div class="form-group">
            <label class="">Phone Number</label>
            <div class="">
              <input type="text" class="form-control" id="editPhoneNo" ng-value="newPhoneNo" />
            </div>
          </div>
          <div class="form-group">
            <label class="">FirstName</label>
            <div class="">
              <input type="text" class="form-control" id="editFirstname" ng-value="newFirstname" />
            </div>
          </div>
          <div class="form-group">
            <label class="">Lastname</label>
            <div class="">
              <input type="text" class="form-control" id="editLastname" ng-value="newLastname" />
            </div>
          </div>
          <div class="form-group">
            <label class="">Title</label>
            <div class="">
              <input type="text" class="form-control" id="editTitle" ng-value="newTitle" />
            </div>
          </div>

          <!-- <div class="form-group">
                  <label class="">Role</label>
                  <div class="">
                      <select id="editRole">
                          <option value="ordinary">Ordinary</option>
                          <option value="super">Super User</option>
                          <option value="admin">Admin</option>
                      </select>
  
  
                  </div>
              </div> -->
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn btn-info" data-dismiss="modal" ng-click="updateUser()">
            Save
          </button>
          <button type="button" class="btn btn btn-danger" ng-click="close()">
            Cancel
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- The Modal -->
  <div id="myModal2" class="modal">
    <!-- Modal content -->
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h4 class="modal-title">Are you sure?</h4>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close" ng-click="close2()">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
          <p>
            You want to delete
            <strong id="deleteUser" style="color: red"></strong> information...
          </p>
          <!-- <p id="deleteUser" ></p> -->
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-danger" ng-click="deleteUser()">
            Yes
          </button>
          <button type="button" class="btn btn-info" ng-click="close2()">
            No
          </button>
        </div>
      </div>
    </div>
  </div>

  <div class="modal" tabindex="-1" id="uploadModal" data-backdrop="static" data-keyboard="false" tabindex="-1"
    aria-labelledby="staticBackdropLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="uploadModalTitle">Uploading...</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close" id="uploadModalClose">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
          <div class="progress" style="height: 15px">
            <div id="uploadProgress" class="progress-bar progress-bar-striped progress-bar-animated" role="progressbar"
              aria-valuenow="0" aria-valuemin="0" aria-valuemax="100"></div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- latest jquery-->
  <script src="assets/js/jquery-3.5.1.min.js"></script>
  <!-- Bootstrap js-->
  <script src="assets/js/bootstrap/popper.min.js"></script>
  <script src="assets/js/bootstrap/bootstrap.js"></script>
  <!-- feather icon js-->
  <script src="assets/js/icons/feather-icon/feather.min.js"></script>
  <script src="assets/js/icons/feather-icon/feather-icon.js"></script>
  <!-- Sidebar jquery-->
  <!-- <script src="assets/js/sidebar-menu.js"></script> -->
  <script src="assets/js/config.js"></script>
  <!-- Plugins JS start-->
  <script src="assets/js/datatable/datatables/jquery.dataTables2.min.js"></script>
  <script src="assets/js/datatable/datatable-extension/dataTables.buttons.min.js"></script>
  <script src="assets/js/datatable/datatable-extension/jszip.min.js"></script>
  <script src="assets/js/datatable/datatable-extension/buttons.colVis.min.js"></script>
  <script src="assets/js/datatable/datatable-extension/pdfmake.min.js"></script>
  <script src="assets/js/datatable/datatable-extension/vfs_fonts.js"></script>
  <script src="assets/js/datatable/datatable-extension/dataTables.autoFill.min.js"></script>
  <script src="assets/js/datatable/datatable-extension/dataTables.select.min.js"></script>
  <script src="assets/js/datatable/datatable-extension/buttons.bootstrap4.min.js"></script>
  <script src="assets/js/datatable/datatable-extension/buttons.html5.min.js"></script>
  <script src="assets/js/datatable/datatable-extension/buttons.print.min.js"></script>
  <script src="assets/js/datatable/datatable-extension/dataTables.bootstrap4.min.js"></script>
  <script src="assets/js/datatable/datatable-extension/dataTables.responsive.min.js"></script>
  <script src="assets/js/datatable/datatable-extension/responsive.bootstrap4.min.js"></script>
  <script src="assets/js/datatable/datatable-extension/dataTables.keyTable.min.js"></script>
  <script src="assets/js/datatable/datatable-extension/dataTables.colReorder.min.js"></script>
  <script src="assets/js/datatable/datatable-extension/dataTables.fixedHeader.min.js"></script>
  <script src="assets/js/datatable/datatable-extension/dataTables.rowReorder.min.js"></script>
  <script src="assets/js/datatable/datatable-extension/dataTables.scroller.min.js"></script>
  <script src="assets/js/datatable/datatable-extension/custom2.js"></script>
  <script src="assets/js/tooltip-init.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.8.0/jszip.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.8.0/xlsx.js"></script>
  <!-- Plugins JS Ends-->
  <!-- Theme js-->
  <script src="assets/js/script.js"></script>
  <script src="assets/js/theme-customizer/customizer.js"></script>

  <script>
    var comid = sessionStorage.getItem("comid");
    var user = sessionStorage.getItem("user");
    var uploadProgress = $("#uploadProgress");
    var uploadCount = 0;
    var progress = 0;
    var clients_array = [];

    var ExcelToJSON = function () {
      this.parseExcel = function (file) {
        var reader = new FileReader();

        reader.onload = function (e) {
          var data = e.target.result;
          var workbook = XLSX.read(data, {
            type: "binary",
          });
          workbook.SheetNames.forEach(function (sheetName) {
            // Here is your object
            var XL_row_object = XLSX.utils.sheet_to_row_object_array(
              workbook.Sheets[sheetName]
            );
            var json_object = JSON.stringify(XL_row_object);
            // console.log(JSON.parse(json_object));
            clients_array = XL_row_object.map((client) => {
              return {
                companyName: client["Company name"],
                firstname: client["First name"],
                lastname: client["Last name"],
                mailingAdd: client["Mailing address"],
                phoneNo: client["Phone number"],
                title: client["Title"],
                email: client["Email address"],
                website: client["Website"],
                comid: comid,
                toWhom: user,
              };
            });
            // console.log(clients_array);

            $("#uploadModal").modal("show");
            // console.log(uploadProgress);
            uploadClients();
          });
        };

        reader.onerror = function (ex) {
          console.log(ex);
        };

        reader.readAsBinaryString(file);
      };
    };

    var uploadClients = async function () {
      for (let i = 0; i < clients_array.length; i++) {
        const client = clients_array[i];
        var clientData = JSON.stringify(client);

        await $.ajax({
          type: "POST",
          dataType: "json",
          url: " https://iqq7nfcdw5.execute-api.us-east-1.amazonaws.com/fvs/clients/{email}",
          data: clientData,
          headers: {
            "Content-Type": "application/json",
          },
          success: function (data) {
            console.log(data);
            uploadCount = uploadCount + 1;
            if (clients_array.length > 100) {
              progress = (clients_array.length * 100) / clients_array.length;
            } else {
              progress = (100 / clients_array.length) * uploadCount;
            }
            uploadProgress.attr("style", `width: ${progress}%`);
            uploadProgress.attr("ariaValueNow", `${progress}`);
            uploadProgress.text(`${progress}%`);
            $("#uploadModalTitle").text(`Uploaded ${uploadCount} clients`);

            // console.log(progress);
          },
          error: function (error) {
            console.log(error);
          },
        });
      }
    };

    function handleFileSelect(evt) {
      var files = evt.target.files; // FileList object
      var xl2json = new ExcelToJSON();
      xl2json.parseExcel(files[0]);
    }

    $("#uploadModalClose").click(function () {
      window.location.href = "#listClient";
    });
    document
      .getElementById("FileUpload1")
      .addEventListener("change", handleFileSelect, false);
  </script>