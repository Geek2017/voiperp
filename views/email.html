<br />
<style>
  textarea {
    resize: none;
  }
</style>
<!-- <link rel="stylesheet" type="text/css" href="/assets/css/style.css" /> -->
<script defer>
  var users = [];
  var employee = [];
  var admin = [];
  var sortedUsers = [];
  var toEmail = [];

  $(document).ready(async () => {
    var settings = {
      url: "https://iqq7nfcdw5.execute-api.us-east-1.amazonaws.com/fvs/allusers",
      method: "GET",
      timeout: 0,
    };
    await $.ajax(settings)
      .done((response) => {
        var count = response.Count;
        for (var i = 0; i < count; i++) {
          var user = {
            fullname: response.Items[i].fullname.S,
            role: response.Items[i].role.S,
            email: response.Items[i].email.S,
          };

          users.push(user);
        }
      })
      .fail((err) => {
        console.log(err);
      });

    sortedUsers = users.sort((a, b) => {
      let fa = a.fullname.toLowerCase(),
        fb = b.fullname.toLowerCase();

      if (fa < fb) {
        return -1;
      }
      if (fa > fb) {
        return 1;
      }
      return 0;
    });

    employee = users.filter((user) => user.role === "ordinary");
    admin = users.filter((user) => user.role === "admin");
  });

  var sendTo = [];

  function getEmail() {
    var users = [];
    var fullNames = document.querySelectorAll(".send-to-name");
    var emails = document.querySelectorAll(".send-to-email");
    var status = document.querySelectorAll(".send-to-status");

    for (let i = 0; i < fullNames.length; i++) {
      const user = {
        fullname: fullNames[i].innerHTML,
        email: emails[i].innerText,
        status: status[i].checked,
      };

      users.push(user);
    }

    users = users.filter((user) => user.status != false);

    return users;
  }

  function getRecipient() {
    sendTo = getEmail();
    var sendToEmail = sendTo.map((user) => user.email);
    // console.log(sendTo);
    toEmail = sendToEmail;
    $("#inputEmail").val(sendToEmail);
    $("#exitBtn").click();
  }

  function sendEmail() {
    var message = $('#message').val();
    var subject = $('#subject').val();
    var to = $('#inputEmail').val();

    if (to && message && subject) {
      // sendTo = getEmail();
      // var sendToEmail = sendTo.map((user) => user.email);
      // console.log(sendTo);
      var settings = {
        url: "https://iqq7nfcdw5.execute-api.us-east-1.amazonaws.com/fvs/users/" + sessionStorage.getItem("user"),
        method: "GET",
        timeout: 0,
      };

      var fromName;
      var fromEmail = sessionStorage.getItem("user");

      $.ajax(settings).done(function (response) {
        var count = response.Count;
        console.log(response);
        fromName = response.fullname;
        for (let index = 0; index < sendTo.length; index++) {
          // console.log(sendTo[index]);
          var template_params = {
            "to_email": sendTo[index].email,
            "subject": $('#subject').val(),
            // "bcc": email,
            // "reply_to": email,
            "from_name": fromName,
            "from_email": fromEmail,
            "to_name": sendTo[index].fullname,
            "message_html": $('#message').val()
          }
          var service_id = "service_fvs";
          var template_id = "template_xtir89j";
          emailjs.send(service_id, template_id, template_params);
          console.log("email has been sent " + sendTo[index].email);
          document.getElementById("success").innerHTML = "Email has been sent";
          document.getElementById("inputEmail").value = "";
          document.getElementById("subject").value = "";
          document.getElementById("message").value = "";
          setTimeout(() => {
            document.getElementById("success").innerHTML = "";

          }, 3000);
        }
      });
    } else {
      document.getElementById("messages").innerHTML = "Check your input";
      setTimeout(() => {
        document.getElementById("messages").innerHTML = "";
      }, 5000)
    }


    // var fromName = sessionStorage.getItem("user");
    // var fromEmail = sessionStorage.getItem("user");

    // toEmail = sendToEmail;
    // $("#inputEmail").val(sendToEmail);
    // $("#exitBtn").click();
  }


  function displayUsers() {
    // console.log(sortedUsers);
    for (let i = 0; i < sortedUsers.length; i++) {
      const user = sortedUsers[i];
      var toAppend = `<div
                  class="card px-2 m-1 d-flex justify-content-start border border-primary rounded user-card"
                >
                  <div class="w-100 d-flex justify-content-start py-2">
                    <label class="input p-2 m-0">
                      <input
                        class="checkbox_animated send-to-status"
                        type="checkbox"
                        name="checkEmail"
                      />
                    </label>
                    <span class="text-left p-2 send-to-name">${user.fullname}</span>
                    <span class="text-left p-2"
                      >&lt;<span class="send-to-email">${user.email}</span>&gt;</span
                    >
                  </div>
                </div>`;
      $("#sendToEmail").append(toAppend);
    }
  }

  function searchContact() {
    var sortBox = document.getElementById("sortBox").value;
    $("#allRadio").prop("checked", true);
    $("#selectCheckbox").prop("checked", false);
    if (sortBox) {
      var searchedUsers = users.filter((user) => {
        return user.fullname.toLowerCase().includes(sortBox.toLowerCase());
      });
      if (searchedUsers) {
        $("#sendToEmail .user-card").remove();
        sortedUsers = searchedUsers;
        displayUsers();
      } else {
        sortedUsers = users;
        $("#sendToEmail .user-card").remove();
        displayUsers();
      }
    } else {
      sortedUsers = users;
      $("#sendToEmail .user-card").remove();
      displayUsers();
    }
  }

  $("input[name=sortRadio]").change(function () {
    if ($(this).is(":checked")) {
      if (this.value == "all") {
        $("input[name=selectCheckbox]").prop("checked", false);
        $("#sendToEmail .user-card").remove();
        sortedUsers = users;
        displayUsers();
      } else if (this.value == "admin") {
        $("input[name=selectCheckbox]").prop("checked", false);
        $("#sendToEmail .user-card").remove();
        sortedUsers = admin;
        displayUsers();
      } else if (this.value == "ordinary") {
        $("input[name=selectCheckbox]").prop("checked", false);
        $("#sendToEmail .user-card").remove();
        sortedUsers = employee;
        displayUsers();
      }
    }
  });

  $("input[name=selectCheckbox]").change(function () {
    if ($(this).is(":checked")) {
      $("input[name=checkEmail]").prop("checked", true);
    } else {
      $("input[name=checkEmail]").prop("checked", false);
    }
  });

  $("#exitBtn").click(function () {
    $("#sendToEmail .user-card").remove();
    $("#sortBox").val("");
    $("input[name=selectCheckbox]").prop("checked", false);
    sortedUsers = users;
  });

  $("#cancelBtn").click(function () {
    $("#sendToEmail .user-card").remove();
    $("#sortBox").val("");
    $("input[name=selectCheckbox]").prop("checked", false);
    sortedUsers = users;
  });

  $("#emailModal").hide(function () {
    $("#sendToEmail .user-card").remove();
    $("#sortBox").val("");
    $("input[name=selectCheckbox]").prop("checked", false);
    sortedUsers = users;
  });

  // state.products = state.products.filter((product) => {
  //       return product.productName
  //         .toLowerCase()
  //         .includes(productName.toLowerCase());
  //     });
</script>
<div class="container-fluid">
  <div class="email-wrap">
    <div class="row d-flex justify-content-center">
      <!-- <div class="col-xl-3 col-md-6 box-col-6">
        <div class="email-left-aside">
          <div class="card">
            <div class="card-body">
              <div class="email-app-sidebar">
                <div class="media">
                  <div class="media-size-email"><img class="mr-3 rounded-circle" src="assets/images/user/user.png"
                      alt=""></div>
                  <div class="media-body">
                    <h6 class="f-w-600">MARKJENCO</h6>
                    <p>Markjecno@gmail.com</p>
                  </div>
                </div>
                <ul class="nav main-menu" role="tablist">
                  <li class="nav-item"><a class="btn-primary btn-block btn-mail" id="pills-darkhome-tab"
                      data-toggle="pill" href="#pills-darkhome" role="tab" aria-controls="pills-darkhome"
                      aria-selected="true"><i class="icofont icofont-envelope mr-2"></i> NEW MAIL</a></li>
                  <li class="nav-item"><a class="show" id="pills-darkprofile-tab" data-toggle="pill"
                      href="#pills-darkprofile" role="tab" aria-controls="pills-darkprofile" aria-selected="false"><span
                        class="title"><i class="icon-import"></i> Inbox</span><span
                        class="badge pull-right digits">(236)</span></a></li>
                  <li><a href="#"><span class="title"><i class="icon-folder"></i> All mail</span></a></li>
                  <li><a href="#"><span class="title"><i class="icon-new-window"></i> Sent</span><span
                        class="badge pull-right digits">(69)</span></a></li>
                  <li><a href="#"><span class="title"><i class="icon-pencil-alt"></i> DRAFT</span><span
                        class="badge pull-right digits">(59)</span></a></li>
                  <li><a href="#"><span class="title"><i class="icon-trash"></i> TRASH</span><span
                        class="badge pull-right digits">(99)</span></a></li>
                  <li><a href="#"><span class="title"><i class="icon-info-alt"></i> IMPORTANT</span></a></li>
                  <li><a href="#"><span class="title"><i class="icon-star"></i> Starred</span></a></li>
                  <li>
                    <hr>
                  </li>
                  <li><a href="#"><span class="title"><i class="icon-email"></i> UNREAD</span></a></li>
                  <li><a href="#"><span class="title"><i class="icon-export"></i> SPAM</span></a></li>
                  <li><a href="#"><span class="title"><i class="icon-share"></i> OUTBOX</span></a></li>
                  <li><a href="#"><span class="title"><i class="icon-file"></i> UPDATE</span></a></li>
                  <li><a href="#"><span class="title"><i class="icon-bell"></i> ALERT</span></a></li>
                  <li><a href="#"><span class="title"><i class="icon-notepad"></i> NOTES</span><span
                        class="badge pull-right digits">(20)</span></a></li>
                </ul>
              </div>
            </div>
          </div>
        </div>
      </div> -->
      <!-- <div class="col-xl-3 col-md-6 box-col-6">
        <div class="email-right-aside">
          <div class="card email-body">
            <div class="pr-0 b-r-light">
              <div class="email-top">
                <div class="row">
                  <div class="col">
                    <h5>Inbox</h5>
                  </div>
                  <div class="col text-right">
                    <div class="dropdown">
                      <button class="btn bg-transparent dropdown-toggle p-0 text-muted" id="dropdownMenuButton"
                        type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">More</button>
                      <div class="dropdown-menu" aria-labelledby="dropdownMenuButton"><a class="dropdown-item"
                          href="#">Action</a><a class="dropdown-item" href="#">Another action</a><a
                          class="dropdown-item" href="#">Something else here</a></div>
                    </div>
                  </div>
                </div>
              </div>
              <div class="inbox">
                <div class="media">
                  <div class="media-size-email"><img class="mr-3 rounded-circle" src="assets/images/user/user.png"
                      alt=""></div>
                  <div class="media-body">
                    <h6>Pork Lorn <small><span class="digits">(15</span> July <span class="digits">2018)</span></small>
                    </h6>
                    <p>Mattis luctus. Donec nisi diam,</p>
                  </div>
                </div>
                <div class="media active">
                  <div class="media-size-email"><img class="mr-3 rounded-circle" src="assets/images/user/user.png"
                      alt=""></div>
                  <div class="media-body">
                    <h6>Lorm lpsa <small><span class="digits">(20</span> January)</small></h6>
                    <p>Mattis luctus. Donec nisi diam,</p>
                  </div>
                </div>
                <div class="media">
                  <div class="media-size-email"><img class="mr-3 rounded-circle" src="assets/images/user/user.png"
                      alt=""></div>
                  <div class="media-body">
                    <h6>Hileri makr <small><span class="digits">(20</span> Aug<span class="digits"> 2018)</span></small>
                    </h6>
                    <p>Mattis luctus. Donec nisi diam,</p>
                  </div>
                </div>
                <div class="media">
                  <div class="media-size-email"><img class="mr-3 rounded-circle" src="assets/images/user/user.png"
                      alt=""></div>
                  <div class="media-body">
                    <h6>Lion Lorpa <small><span class="digits">(02</span> Jun <span class="digits">2016)</span></small>
                    </h6>
                    <p>Mattis luctus. Donec nisi diam,</p>
                  </div>
                </div>
                <div class="media">
                  <div class="media-size-email"><img class="mr-3 rounded-circle" src="assets/images/user/user.png"
                      alt=""></div>
                  <div class="media-body">
                    <h6 class="mt-0">Solvn Relto <small><span class="digits">(25</span> July <span
                          class="digits">2015)</span></small></h6>
                    <p>Mattis luctus. Donec nisi diam,</p>
                  </div>
                </div>
                <div class="media">
                  <div class="media-size-email"><img class="mr-3 rounded-circle" src="assets/images/user/user.png"
                      alt=""></div>
                  <div class="media-body">
                    <h6>Repro Soft <small><span class="digits">(15</span> July <span class="digits">2018)</span></small>
                    </h6>
                    <p>Mattis luctus. Donec nisi diam,</p>
                  </div>
                </div>
                <div class="media">
                  <div class="media-size-email"><img class="mr-3 rounded-circle" src="assets/images/user/user.png"
                      alt=""></div>
                  <div class="media-body">
                    <h6>Lion Lorpa <small><span class="digits">(02</span> Jun <span class="digits">2016)</span></small>
                    </h6>
                    <p>Mattis luctus. Donec nisi diam,</p>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div> -->
      <div class="col-xl-8 col-md-8 box-col-12">
        <div class="email-right-aside">
          <div class="card">
            <div class="pl-0">
              <div class="tab-content">
                <div class="tab-pane fade active show" id="pills-darkhome" role="tabpanel"
                  aria-labelledby="pills-darkhome-tab">
                  <div class="email-compose">
                    <br>
                    <div class="text-danger wrapper text-center" id="messages"></div>
                    <div class="text-success wrapper text-center" id="success"></div>
                    <div class="email-top compose-border">
                      <div class="row">
                        <div class="col-sm-8 xl-50">
                          <h4 class="mb-0">New Email</h4>
                        </div>
                      </div>
                    </div>
                    <div class="email-wrapper">
                      <form class="theme-form">
                        <div class="form-group">
                          <label class="col-form-label pt-0" for="inputEmail">To</label>
                          <div class="d-flex">
                            <input class="form-control" id="inputEmail" type="email" data-toggle="modal"
                              data-target="#emailModal" onclick="displayUsers()" />
                            <a href="javascript:void(0)"
                              class="d-flex ml-3 px-2 rounded btn-primary justify-content-center align-items-center"
                              data-toggle="modal" data-target="#emailModal" onclick="displayUsers()"
                              style="width: auto; height: 34px">Contacts
                              <i class="fa fa-angle-down ml-2"></i>
                            </a>
                          </div>
                        </div>
                        <div class="form-group">
                          <label for="subject">Subject</label>
                          <input class="form-control" id="subject" type="text" />
                        </div>
                        <div class="form-group">
                          <label for="text-box">Message</label>
                          <textarea class="form-control" id="message" name="text-box" rows="4" cols="180"></textarea>
                        </div>
                      </form>
                    </div>
                    <div class="col-sm-12">
                      <button class="btn btn-primary btn-block btn-mail text-center mb-3 mt-0" type="button"
                        onclick="sendEmail()">
                        <i class="fa fa-paper-plane mr-2"></i> SEND
                      </button>
                    </div>
                  </div>
                </div>
                <div class="tab-pane fade" id="pills-darkprofile" role="tabpanel"
                  aria-labelledby="pills-darkprofile-tab">
                  <div class="email-content">
                    <div class="email-top">
                      <div class="row">
                        <div class="col-md-6 xl-100 col-sm-12">
                          <div class="media">
                            <img class="mr-3 rounded-circle" src="assets/images/user/user.png" alt="" />
                            <div class="media-body">
                              <h6>
                                Lorm lpsa
                                <small><span class="digits">(20</span> January)
                                  <span class="digits">6:00</span> AM</small>
                              </h6>
                              <p>Mattis luctus. Donec nisi diam text.</p>
                            </div>
                          </div>
                        </div>
                        <div class="col-md-6 col-sm-12">
                          <div class="float-right d-flex">
                            <p class="user-emailid">
                              Lormlpsa<span class="digits">23</span>@company.com
                            </p>
                            <i class="fa fa-star-o f-18 mt-1"></i>
                          </div>
                        </div>
                      </div>
                    </div>
                    <div class="email-wrapper">
                      <p>Hello</p>
                      <p>Dear Sir Good Morning,</p>
                      <h5>
                        Elementum varius nisi vel tempus. Donec eleifend egestas
                        viverra.
                      </h5>
                      <p class="m-b-20">
                        Lorem ipsum dolor sit amet, consectetur adipiscing elit.
                        Curabitur non diam facilisis, commodo libero et, commodo
                        sapien. Pellentesque sollicitudin massa sagittis dolor
                        facilisis, sit amet vulputate nunc molestie.
                        Pellentesque maximus nibh id luctus porta. Ut
                        consectetur dui nec nulla mattis luctus. Donec nisi
                        diam, congue vitae felis at, ullamcorper bibendum
                        tortor. Vestibulum pellentesque felis felis. Etiam ac
                        tortor felis. Ut elit arcu, rhoncus in laoreet vel,
                        gravida sed tortor.
                      </p>
                      <p>
                        In elementum varius nisi vel tempus. Donec eleifend
                        egestas viverra. Donec dapibus sollicitudin blandit.
                        Donec scelerisque purus sit amet feugiat efficitur.
                        Quisque feugiat semper sapien vel hendrerit. Mauris
                        lacus felis, consequat nec pellentesque viverra,
                        venenatis a lorem. Sed urna lectus.Quisque feugiat
                        semper sapien vel hendrerit
                      </p>
                      <hr />
                      <div class="d-inline-block">
                        <h6 class="text-muted">
                          <i class="icofont icofont-clip"></i> ATTACHMENTS
                        </h6>
                        <a class="text-muted text-right right-download" href="#"><i
                            class="fa fa-long-arrow-down mr-2"></i>Download
                          All</a>
                        <div class="clearfix"></div>
                      </div>
                      <div class="attachment">
                        <ul class="list-inline">
                          <li class="list-inline-item">
                            <img class="img-fluid" src="assets/images/email/1.jpg" alt="" />
                          </li>
                          <li class="list-inline-item">
                            <img class="img-fluid" src="assets/images/email/2.jpg" alt="" />
                          </li>
                          <li class="list-inline-item">
                            <img class="img-fluid" src="assets/images/email/3.jpg" alt="" />
                          </li>
                        </ul>
                      </div>
                      <hr />
                      <div class="action-wrapper">
                        <ul class="actions">
                          <li>
                            <a class="text-muted" href="#"><i class="fa fa-reply mr-2"></i>Reply</a>
                          </li>
                          <li>
                            <a class="text-muted" href="#"><i class="fa fa-reply-all mr-2"></i>Reply All</a>
                          </li>
                          <li>
                            <a class="text-muted" href="#"><i class="fa fa-share mr-2"></i></a>Forward
                          </li>
                        </ul>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="modal fade" id="emailModal" data-backdrop="static" data-keyboard="false" tabindex="-1"
        aria-labelledby="emailModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-scrollable">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title" id="emailModalLabel">Send to</h5>
              <button type="button" class="close" data-dismiss="modal" aria-label="Close" id="exitBtn">
                <span aria-hidden="true">&times;</span>
              </button>
            </div>
            <div class="modal-body">
              <div class="sort-box row">
                <div class="col">
                  <div class="form-group mb-0 px-1">
                    <input class="form-control" id="sortBox" type="text" placeholder="Search contacts"
                      onkeyup="searchContact()" />
                  </div>
                  <div class="form-group mb-0 px-2">
                    <div class="w-100 d-flex">
                      <div class="sort-radio w-75">
                        <span class="my-2 d-block">Sort by:</span>
                        <div class="form-check form-check-inline">
                          <label class="input m-0">
                            <input class="radio_animated" type="radio" name="sortRadio" id="allRadio" value="all"
                              checked />
                            All
                          </label>
                        </div>
                        <div class="form-check form-check-inline">
                          <label class="input m-0">
                            <input class="radio_animated" type="radio" name="sortRadio" id="adminRadio" value="admin" />
                            Admin
                          </label>
                        </div>
                        <div class="form-check form-check-inline">
                          <label class="input m-0">
                            <input class="radio_animated" type="radio" name="sortRadio" id="empRadio"
                              value="ordinary" />
                            Employee
                          </label>
                        </div>
                      </div>
                      <div class="w-25 d-flex justify-content-center">
                        <div class="form-check form-check-inline align-self-end">
                          <input class="form-check-input checkbox_animated mr-4" type="checkbox" name="selectCheckbox"
                            id="selectCheckbox" />
                          <label class="form-check-label" for="adminRadio">
                            Select all
                          </label>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              <hr />
              <div id="sendToEmail"></div>
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-primary" onclick="getRecipient()">
                Ok
              </button>
              <button type="button" class="btn btn-secondary" id="cancelBtn" data-dismiss="modal">
                Cancel
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>