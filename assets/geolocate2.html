<!DOCTYPE html>
<html>

<head>
  <title>Geolocation</title>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
  <script src="https://polyfill.io/v3/polyfill.min.js?features=default"></script>
  <script
    src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDENyuxiDy6R45RVnr6jhPqGM3o5cUDS1k&callback=initMap&libraries=&v=weekly"
    defer></script>
  <style type="text/css">
    /* Always set the map height explicitly to define the size of the div
       * element that contains the map. */

    #map {
      height: 100%;
    }

    /* Optional: Makes the sample page fill the window. */

    html,
    body {
      height: 100%;
      margin: 0;
      padding: 0;
    }

    .custom-map-control-button {
      appearance: button;
      background-color: #fff;
      border: 0;
      border-radius: 2px;
      box-shadow: 0 1px 4px -1px rgba(0, 0, 0, 0.3);
      cursor: pointer;
      margin: 10px;
      padding: 0 0.5em;
      height: 40px;
      font: 400 18px Roboto, Arial, sans-serif;
      overflow: hidden;
    }

    .custom-map-control-button:hover {
      background: #ebebeb;
    }
  </style>
  <script src="/assets/geolocate.js"></script>
</head>

<body onload="loadBody()" onunload="unloadBody()">
  <div id="map"></div>
  <script>
    let lat = 0;
    let lng = 0;
    let map, infoWindow;

    function loadBody() {
      lat = parseFloat(sessionStorage.getItem("lat")) || 14.599512;
      lng = parseFloat(sessionStorage.getItem("lng")) || 120.984222;
    }

    function initMap() {
      setTimeout(() => {
        map = new google.maps.Map(document.getElementById("map"), {
          center: {
            lat: lat, //change this to US lat
            lng: lng, //change this to US lng
          },
          zoom: 14,
        });
        infoWindow = new google.maps.InfoWindow();

        const geocoder = new google.maps.Geocoder();
        const latlng = {
          lat: lat,
          lng: lng,
        };
        geocoder.geocode({
            location: latlng,
          },
          (results, status) => {
            if (status === "OK") {
              if (results[0]) {
                map.setCenter(results[0].geometry.location);
                map.setZoom(14);
                const marker = new google.maps.Marker({
                  position: results[0].geometry.location,
                  map: map,
                });
                infoWindow.setContent(results[0].formatted_address);
                infoWindow.open(map, marker);
              } else {
                window.alert("No results found");
              }
            } else {
              window.alert("Geocoder failed due to: " + status);
            }
          }
        );
      }, 500);
    }

    function unloadBody() {
      lat = 0;
      lng = 0;
      sessionStorage.removeItem("lat");
      sessionStorage.removeItem("lng");
    }
  </script>
</body>


</html>